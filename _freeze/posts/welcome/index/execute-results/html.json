{
  "hash": "d894add8c6a9abe448870b44c5f2a982",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Monitoramento de frota de √¥nibus\"\nauthor: \"Anielly Miranda\"\ndate: \"2025-11-20\"\ncategories: [code, monitoramento dos √¥nibus]\njupyter: python3\nimage: \"onibus.png\"\n---\n\nMapeando a mobilidade urbana! \nNesta atividade, constru√≠ um mapa interativo com as paradas de uma linha de √¥nibus e a posi√ß√£o em tempo real dos ve√≠culos. \n\n::: {#6b50000f .cell execution_count=1}\n``` {.python .cell-code}\nimport requests\nimport folium\nimport os\nfrom dotenv import load_dotenv\n\nload_dotenv()\nTOKEN = os.getenv(\"TOKEN_SPTRANS\")\nURL_BASE = \"https://api.olhovivo.sptrans.com.br/v2.1\"\n\nif not TOKEN:\n    raise ValueError(\"‚ùå Token SPTrans n√£o encontrado.\")\n\n# Cria uma sess√£o persistente\nsess = requests.Session()\n\n# 1Ô∏è‚É£ Autentica√ß√£o\nlogin_url = f\"{URL_BASE}/Login/Autenticar?token={TOKEN}\"\nauth = sess.post(login_url)\nif auth.status_code != 200 or auth.json() is not True:\n    raise Exception(f\"‚ùå Falha na autentica√ß√£o ({auth.status_code}): {auth.text}\")\nprint(\"‚úÖ Autentica√ß√£o bem-sucedida!\")\n\n# 2Ô∏è‚É£ Buscar a linha\nnumero_linha = \"875A-10\"\nbusca_linha_url = f\"{URL_BASE}/Linha/Buscar?termosBusca={numero_linha}\"\nresp_linha = sess.get(busca_linha_url)\nif resp_linha.status_code != 200 or not resp_linha.json():\n    raise Exception(f\"‚ùå Linha n√£o encontrada. Status: {resp_linha.status_code}\")\n\nlinha = resp_linha.json()[0]\ncodigo_linha = linha[\"cl\"]\nnome_linha = f\"{linha['lt']} - {linha['tp']}\"\nprint(f\"üöç Linha encontrada: {nome_linha} (C√≥digo {codigo_linha})\")\n\n# 3Ô∏è‚É£ Buscar paradas\nparadas_url = f\"{URL_BASE}/Parada/BuscarParadasPorLinha?codigoLinha={codigo_linha}\"\nresp_paradas = sess.get(paradas_url)\nparadas = resp_paradas.json()\n\nprint(f\"üìç {len(paradas)} paradas encontradas.\")\nlats = [p[\"py\"] for p in paradas]\nlons = [p[\"px\"] for p in paradas]\ncentro = (sum(lats)/len(lats), sum(lons)/len(lons))\nmapa = folium.Map(location=centro, zoom_start=12)\n\nfor p in paradas:\n    folium.Marker(\n        location=(p[\"py\"], p[\"px\"]),\n        popup=p[\"np\"],\n        icon=folium.Icon(color=\"blue\")\n    ).add_to(mapa)\n\n# 4Ô∏è‚É£ Posi√ß√µes em tempo real\nposicao_url = f\"{URL_BASE}/Posicao/Linha?codigoLinha={codigo_linha}\"\nresp_posicao = sess.get(posicao_url)\ndados = resp_posicao.json()\nveiculos = dados.get(\"vs\", [])\nprint(f\"üö¶ {len(veiculos)} ve√≠culos em tempo real.\")\n\nfor v in veiculos:\n    folium.Marker(\n        location=(v[\"py\"], v[\"px\"]),\n        popup=f\"Ve√≠culo: {v['p']}\",\n        icon=folium.Icon(color=\"red\")\n    ).add_to(mapa)\n\nmapa.save(\"mapa_875A10.html\")\nprint(\"üó∫Ô∏è Mapa salvo como mapa_875A10.html\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n‚úÖ Autentica√ß√£o bem-sucedida!\nüöç Linha encontrada: 875A - PERDIZES (C√≥digo 609)\nüìç 7 paradas encontradas.\nüö¶ 0 ve√≠culos em tempo real.\nüó∫Ô∏è Mapa salvo como mapa_875A10.html\n```\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}